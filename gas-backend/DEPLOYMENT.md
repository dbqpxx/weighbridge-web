# 焚化廠地磅系統部署指南

本文件說明如何將地磅查詢分析統計系統部署到 Google Apps Script。

## 📋 準備工作

### 1. 建立 Google 試算表資料庫

1. 前往 [Google 試算表](https://sheets.google.com)
2. 建立新的試算表，命名為「**焚化廠地磅資料庫**」
3. 記下試算表的 ID（網址中 `/d/` 和 `/edit` 之間的字串）

   例如：`https://docs.google.com/spreadsheets/d/`**`1ABC123xyz456`**`/edit`

### 2. 開啟 Apps Script 編輯器

1. 在試算表中，點選功能表 **擴充功能** → **Apps Script**
2. 這會開啟 Apps Script 編輯器

---

## 🚀 部署步驟

### 步驟 1：建立專案檔案

在 Apps Script 編輯器中，建立以下檔案：

#### 1.1 主程式 (Code.gs)

1. 刪除預設的 `function myFunction() {}` 內容
2. 將 `gas-backend/Code.gs` 的完整內容貼上
3. **重要**：將第 18 行的 `YOUR_SPREADSHEET_ID_HERE` 替換為您的試算表 ID

```javascript
const CONFIG = {
  // 替換為您的試算表 ID
  SPREADSHEET_ID: '1ABC123xyz456',  // ← 修改這裡
  ...
};
```

#### 1.2 HTML 頁面 (index.html)

1. 點選左側 **+** → **HTML**
2. 命名為 `index`（不需要 .html 副檔名）
3. 將 `gas-backend/index.html` 的完整內容貼上

#### 1.3 樣式表 (styles.html)

1. 點選左側 **+** → **HTML**
2. 命名為 `styles`
3. 將 `gas-backend/styles.html` 的完整內容貼上

#### 1.4 JavaScript (scripts.html)

1. 點選左側 **+** → **HTML**
2. 命名為 `scripts`
3. 將 `gas-backend/scripts.html` 的完整內容貼上

### 步驟 2：初始化資料庫

1. 在 Code.gs 中找到 `initializeDatabase` 函數
2. 點選上方執行按鈕 ▶️，選擇執行 `initializeDatabase`
3. 首次執行會要求授權，請允許
4. 執行完成後，回到試算表確認已建立 Master、Config、UploadLog 三個工作表

### 步驟 3：部署為 Web App

1. 點選右上角 **部署** → **新增部署作業**
2. 點選齒輪圖示，選擇 **網頁應用程式**
3. 設定：
   - **說明**：焚化廠地磅查詢系統 v1.0
   - **執行身分**：我（您的帳號）
   - **誰可以存取**：任何人（如需限制請選擇「貴機構內的使用者」）
4. 點選 **部署**
5. 複製產生的 **網頁應用程式網址**

---

## ✅ 測試系統

### 1. 開啟系統

使用瀏覽器開啟剛才複製的網址，應該會看到地磅查詢系統介面。

### 2. 上傳測試資料

1. 點選左側選單「**資料上傳**」
2. 選擇廠區（如：南區廠）
3. 輸入年月（如：115-01）
4. 上傳您的月報表 Excel 檔案
5. 點選「上傳資料」

### 3. 查看統計

1. 點選「**總覽**」查看統計儀表板
2. 點選「**查詢分析**」進行資料查詢
3. 點選「**跨廠比較**」查看三廠比較

---

## 🔧 進階設定

### 自訂垃圾種類

在 `Code.gs` 的 `CONFIG.WASTE_TYPES` 陣列中修改：

```javascript
WASTE_TYPES: [
  '一般廢棄物',
  '事業廢棄物',
  // 新增或修改種類
]
```

### 新增廠區

在 `CONFIG.PLANTS` 中新增：

```javascript
PLANTS: {
  'south': '南區廠',
  'renwu': '仁武廠',
  'gangshan': '岡山廠',
  'newplant': '新廠區'  // 新增
}
```

### 定時自動備份

1. 在 Apps Script 編輯器中，點選左側時鐘圖示（觸發條件）
2. 新增觸發條件
3. 選擇要執行的函數（可自訂備份函數）
4. 設定執行頻率（每日/每週）

---

## 📱 手機版使用

系統採用響應式設計，可直接用手機瀏覽器開啟網址使用。

建議將網址加入手機主畫面，可獲得類似 App 的使用體驗：

- **iOS**：Safari → 分享 → 加入主畫面
- **Android**：Chrome → 選單 → 新增至主畫面

---

## 🔄 版本更新

當需要更新系統時：

1. 修改 Apps Script 中的程式碼
2. 點選 **部署** → **管理部署作業**
3. 點選編輯（鉛筆圖示）
4. 版本選擇「**新版本**」
5. 點選 **部署**

---

## ❓ 常見問題

### Q: 無法存取試算表？

確認 `SPREADSHEET_ID` 設定正確，且執行身分有該試算表的編輯權限。

### Q: 上傳失敗？

1. 確認 Excel 格式與範本一致
2. 確認第一列為標題列
3. 檢查日期格式是否正確

### Q: 圖表沒有資料？

確認已成功上傳至少一個月份的資料。

---

## 📞 技術支援

如有問題，請提供：
- 錯誤訊息截圖
- 操作步驟描述
- 使用的瀏覽器版本
